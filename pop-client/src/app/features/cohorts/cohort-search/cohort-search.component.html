<div class="flex">
    <h1 class="mb-0">{{ isUserPage() ? 'My Cohorts' : 'Cohorts Search'}}</h1>
</div>

<div class="flex">
    <div class="my-auto ml-3">
        @if (cohorts.isLoading()) {
            <p-skeleton width="4rem" height="2rem"/>
        } @else {
            <span class="font-bold text-2xl mr-2">{{ totalCohorts() }}</span> (Cohorts)
        }
    </div>        
    <div class="flex ml-auto">

        <p-iconfield>
            <p-inputicon styleClass="pi pi-search" />
            <input type="text" pInputText placeholder="Search" [(ngModel)]="searchQuery"/>
        </p-iconfield>
        <!-- Button to add new cohorts -->
        <p-button 
            (onClick)="openNewCohortForm()" 
            label="New cohort" 
            class="ml-3"
            [icon]="'pi pi-plus'"/>
    </div>
</div>
    
<p-divider></p-divider>

@if (cohorts.isLoading()) {
    <div class="grid mt-3 gap-3">
        @for (_ of [].constructor(15); track $index; let first = $first;) {
            <div class="pop-cohort-search-item-card placeholder">
                <div class="flex my-3 gap-3">
                    <p-skeleton width='4rem' height='2rem'/>
                    <p-skeleton width='40rem' height='2rem'/>    
                    <p-skeleton width='5rem' height='2rem'/>    
                </div>
                <div class="flex my-3 gap-3">
                    <p-skeleton width='4rem' height='2rem'/>
                    <p-skeleton width='6rem' height='2rem'/>
                    <p-skeleton width='6rem' height='2rem'/>
                    <p-skeleton width='6rem' height='2rem'/>
                    <p-skeleton width='9rem' height='2rem' class="ml-auto"/>    
                </div>
            </div>        
        }
    </div>
}

<p-dataView 
    styleClass="pop-cohort-search-dataview"
    [value]="cohorts.value() || undefined"
    [paginator]="true" 
    [rows]="pagination().limit" 
    layout="grid"
    sortField="createdAt"
    lazy="true"
    [rowsPerPageOptions]="pageSizeChoices"
    [totalRecords]="totalCohorts()"
    (onLazyLoad)="pagination.set({limit: $event.rows, offset: $event.first})"
    class="no-background">

    <ng-template #grid let-cohorts>
        <div class="grid mt-3">
            @for (cohort of cohorts; track cohort.id; let first = $first;) {
                <div class="col col-6 p-2">
                    <pop-cohort-search-item [cohort]="cohort" (delete)="cohorts.reload()"/>
                </div>
            }
        </div>
    </ng-template>
</p-dataView>



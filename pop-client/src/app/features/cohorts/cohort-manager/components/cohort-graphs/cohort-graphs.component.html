
<p-card>
    <p-panel header="Demographics" [toggleable]="true">

        <div class="flex">
            <div class="flex flex-column">
                <div class="font-semibold">Patient Traits</div>
                <div class="text-muted mb-2">
                    Basic statistics over the demographical composition of the cohort.
                </div>
                <div class="flex mx-auto my-3 gap-3 w-full">
                    <div>
                        @if (loading() || genderCount.isLoading()) {
                            <p-skeleton height="10rem" width="15rem"/>
                        } @else {
                            @if (genderCount.value(); as data) {
                                <pop-doughnut-graph [data]="data"/>
                            }
                        }
                    </div>
                    <div>
                        @if (loading() || vitalStatusCount.isLoading()) {
                            <p-skeleton height="10rem" width="15rem"/>
                        } @else {
                            @if (vitalStatusCount.value(); as data) {
                                <pop-doughnut-graph [data]="data"/>
                            }
                        }
                    </div>
                </div>
                <div>
                    <div class="mt-3 mr-4">
                        @if (loading() || ageCount.isLoading()) {
                            <p-skeleton height="15rem"/>
                        } @else {
                            @if (ageCount.value(); as data) {
                                <pop-distribution-graph [data]="data"/>
                            }
                        }
                    </div>
                </div>
            </div>
            <div class="ml-4">
                <div class="font-semibold">Age at diagnosis</div>
                <div class="text-muted mb-2">
                    Distribution of age at the time of the diagnosis of the first primary neoplastic entity. 
                </div>
                <div class="mt-3 mr-4">
                    @if (loading() || ageAtDiagnosisCount.isLoading()) {
                        <p-skeleton height="15rem"/>
                    } @else {
                        @if (ageAtDiagnosisCount.value(); as data) {
                            <pop-distribution-graph [data]="data"/>
                        }
                    }
                </div>
                <div class="font-semibold">Neoplastic sites</div>
                <div class="text-muted mb-2">
                    Distribution of general topographical sites of the neoplastic entities in the cohort. 
                </div>
                <div class="mt-3 mr-4">
                    @if (loading() || neoplasticSitesCount.isLoading()) {
                        <p-skeleton height="15rem"/>
                    } @else {
                        @if (neoplasticSitesCount.value(); as data) {
                            <pop-doughnut-graph [data]="data" legendPosition="right" width="30rem"/>
                        }
                    }
                </div>
            </div>
        </div>    
    
    </p-panel>
    

    <p-panel header="Cohort Characteristics" [toggleable]="true" styleClass="mt-4">      
        <div class="font-semibold">Overall survival (OS)</div>
        <div class="text-muted mb-2">
            Kaplan-Meier survival analysis of the overall survival of the patients in the cohort since the initial diagnosis. 
        </div>  
        @if (cohort().population < 10) {
            <p-message severity="warn" styleClass="mb-5">Cohort population too small. The Kaplan-Meier analysis requires at least 10 cases.</p-message>
        } @else {
            @if (loading() || overallSurvivalCurve.isLoading()) { 
                <p-skeleton height="30rem" width="60%"/>
            } @else { 
                @if (overallSurvivalCurve.value(); as data) {
                    <pop-kappler-meier-curve [data]="data"/>   
                } 
            }
        } 

        <div class="font-semibold">Genomic variants (Oncoplot)</div>
        <div class="text-muted mb-2">
            A summary of the genomics of the cohort
        </div>
        @if (cohort().population < 10) {
            <p-message severity="warn" styleClass="mb-5">Cohort population too small. The Oncoplot analysis requires at least 10 cases.</p-message>
        } @else {
            @if (loading() || cohortGenomics.isLoading()) { 
                <p-skeleton height="30rem" width="100%"/>
            } @else { 
                @if (cohortGenomics.value(); as data) {
                    <pop-oncoplot [data]="data"/>    
                }
            }
        }
    </p-panel>
    
    <p-panel header="Therapy lines" [toggleable]="true" styleClass="mt-4">
            
        @if (therapyLinesCount.value() && therapyLineOptions().length>0) {
            <div class="text-muted mb-1">
                Select the therapy line to analyze
            </div>
            <p-selectbutton 
            [options]="therapyLineOptions()" 
            [(ngModel)]="selectedTherapyLine" 
            (onChange)="selectedTherapyLine.set($event.value)"/>
        }

        <div class="font-semibold mt-4">Progression-free survival (PFS)</div>
        <div class="text-muted mb-2">
            Kaplan-Meier survival analysis of the progression-free survival of the patients in the cohort during the therapy line. 
        </div>    
        @if (therapyLineOptions().length==0) {
            <p-message severity="warn" styleClass="mb-5">No therapy lines have been assigned to this cohort's cases.</p-message>
        }@else if (cohort().population < 10) {
            <p-message severity="warn" styleClass="mb-5">Cohort population too small. The Kaplan-Meier analysis requires at least 10 cases.</p-message>
        } @else {
            @if (loading() || therapyLineSurvivalCurve.isLoading()) {
                <p-skeleton height="30rem" width="60%"/>
            } @else {
                @if (therapyLineSurvivalCurve.value(); as data) {
                    <pop-kappler-meier-curve [data]="data"/>
                }
            }
        }

        <div class="font-semibold mt-4">Performance of therapeutic approaches </div>
        <div class="text-muted mb-2">
            A comparison of the progression-free survival (PFS) under the most common therapy approaches for this cohort.
        </div>    
        @if (therapyLineOptions().length==0) {
            <p-message severity="warn" styleClass="mb-5">No therapy lines have been assigned to this cohort's cases.</p-message>
        }@else if (cohort().population < 10) {
            <p-message severity="warn" styleClass="mb-5">Cohort population too small. The Kaplan-Meier analysis requires at least 10 cases.</p-message>
        } @else {
            @if (loading() || therapyLineTherapyClassifications.isLoading()) {
                <p-skeleton height="15rem"/>
            } @else {
                @if (therapyLineTherapyClassifications.value(); as data) {
                    <pop-box-plot [data]="data"/>
                }
            }
        }

        <div class="font-semibold mt-4">Performance of combination therapies</div>
        <div class="text-muted mb-2">
            A comparison of the progression-free survival (PFS) under the most common drug combinations for this cohort.
        </div>    
        @if (therapyLineOptions().length==0) {
            <p-message severity="warn" styleClass="mb-5">No therapy lines have been assigned to this cohort's cases.</p-message>
        }@else if (cohort().population < 10) {
            <p-message severity="warn" styleClass="mb-5">Cohort population too small. The Kaplan-Meier analysis requires at least 10 cases.</p-message>
        } @else {
            @if (loading() || therapyLineDrugCombinations.isLoading()) {
                <p-skeleton height="15rem"/>
            } @else {
                @if (therapyLineDrugCombinations.value(); as data) {
                    <pop-box-plot [data]="data"/>
                }
            }
        }
    </p-panel>

</p-card>
<p-drawer [(visible)]="visible" position="right" (onHide)="visibleChange.emit(false)" >
    <ng-template #header>
        <div class="drawer-header flex items-center gap-2">
            <p-avatar 
                size="large" 
                shape="square" 
                [style]="{ 'background': 'color-mix(in srgb, var(--p-primary-500), transparent 75%)', color: 'var(--p-primary-500)' }">
                <lucide-angular [img]="icon"></lucide-angular>
            </p-avatar>
            <div class="font-bold my-auto">{{data.description || 'Unknown'}}</div>
        </div>
    </ng-template>

    <div class="property">
        <small class="property-label">Database ID</small>
        <div class="monospace"><small>{{ data.id }}</small></div>
    </div>

    <p-divider/>

    <pop-drawer-properties [data]="data"/>

    <p-divider/>

    <div>
        History
        @let history = history$ | async;
        @if (history) {
        <p-timeline [value]="history" class="history">
            <ng-template pTemplate="content" let-event>
                <div class="flex mb-4" style="margin-top: -0.5rem;">
                    <pop-user-badge [username]="event.user" class="my-auto mr-2" style="scale: .9;"/>
                    <div>
                        <div class="case-manager-panel-timeline-date">
                            <small>{{ event.timestamp | date: 'MMM d, y, h:mm' }}</small>
                        </div>
                        <div class="timeline-event-category">
                            <small>
                                @switch (event.category) {
                                    @case ('create') {
                                        <i class="pi pi-sparkles"></i> Created resource
                                    }
                                    @case ('update') {
                                        <i class="pi pi-pencil"></i> Updated {{ (event.differential | keyvalue).length }} {{ event.differential.length > 1 ? 'properties' : 'property'}}
                                    }
                                    @case ('export') {
                                        <i class="pi pi-file-export"></i> Exported resource
                                    }
                                }
                            </small>
                        </div>                                                
                    </div>                    
                </div>                
            </ng-template>
        </p-timeline>
        }
    </div>

    <ng-template #footer>
    
        
        <div class="flex items-center gap-2">
            <p-button 
                label="Hide" 
                icon="pi pi-eye-slash" 
                class="w-full" 
                severity="secondary"
                (click)="visibleChange.emit(false)"
                outlined/>
            <p-confirmdialog />
            <p-splitbutton 
                label="Edit" 
                [disabled]="!authService.user.canManageCases"
                [buttonDisabled]="!editable"
                [icon]="authService.user.canManageCases? 'pi pi-pencil' : 'pi pi-lock'" 
                dropdownIcon="pi pi-cog" 
                (onClick)="visibleChange.emit(false); update.emit(data)"
                [model]="actionItems" 
                outlined/>
        </div>

    </ng-template>
</p-drawer>
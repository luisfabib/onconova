<div class="flex flex-column" *ngIf="manager">
    <h2 class="mb-0 font-semibold">My Cases</h2>
    <div class="text-muted">Welcome to your personal case search page. You can find all patient cases managed by you.</div>
</div>
<div class="flex flex-column" *ngIf="!manager">
    <h2 class="mb-0 font-semibold">Cases</h2>
    <div class="text-muted">Welcome to the case search page. You can find all existing patient cases here.</div>
</div>


<!-- use ngTemplateOutlet to conditionally render templates -->
<p-toolbar styleClass="my-3 border-transparent">
    <ng-template #start>
        <div class="mt-auto ml-3">
            <div class="text-muted"><small>Total cases</small></div>
            <div *ngIf="!loadingCases" class="text-center font-semibold" style="font-size: 2rem;" [ngxCountAnimation]="totalCases" duration="500"></div>
            <p-skeleton *ngIf="loadingCases" [style]="{ width: '4rem', height: '2rem'}"></p-skeleton>
        </div>        
    </ng-template>
    <ng-template #end>
        <div class="flex">
            <p-iconfield>
                <p-inputicon styleClass="pi pi-search"/>
                <input type="text" pInputText placeholder="Search" [(ngModel)]="searchQuery" (ngModelChange)="refreshCases()" />
            </p-iconfield>
            <p-button 
                icon="pi pi-sync"
                severity="secondary"
                class="mx-2"/>
            <p-button 
                label="Filters" 
                icon="pi pi-filter"
                severity="secondary"/>
            <p-divider layout="vertical"></p-divider>
            <!-- Button to add new cases -->
            <p-button 
                (onClick)="openNewCaseForm()" 
                [disabled]="!authService.user.canManageCases"
                label="Register Case"
                [icon]="authService.user.canManageCases ? 'pi pi-plus' : 'pi pi-lock'"/>
        </div>
    </ng-template>
</p-toolbar>
    

    <!-- Skeleton loader -->
    <ng-container *ngIf="loadingCases">
        <div class="grid gap-5 mt-5">
            <ng-container *ngFor="let _ of [].constructor(15); let first=first" class="col p-2" >
                <div class="loading-card card flex-column p-3 gap-3 mb-3" style="width: 30rem; height: 20rem;">
                    <div class="flex my-3">
                        <p-skeleton [style]="{ width: '5rem', height: '5rem'}"></p-skeleton>
                        <div class="flex flex-column mx-3">
                            <p-skeleton class="mb-2 mt-3" [style]="{ width: '10rem', height: '1.5rem'}"></p-skeleton>    
                            <p-skeleton [style]="{ width: '20rem', height: '1.5rem' }"></p-skeleton>      
                        </div>
                    </div>
                    <div class="mb-3 mt-4">
                        <p-skeleton [style]="{ width: '100%', height: '2rem'}"></p-skeleton>
                    </div>
                    <div class="my-3 mb-5">
                        <p-skeleton [style]="{ width: '100%', height: '2rem'}"></p-skeleton>
                    </div>
                    <p-skeleton class="my-3 ml-auto"  [style]="{ width: '20rem', height: '2rem' }"></p-skeleton>      
                </div>
            </ng-container>
        </div>
    </ng-container>

    @let cases = cases$ | async;
    <p-dataView 
        [value]="cases || undefined"
        [paginator]="true" 
        [rows]="pageSize" 
        layout="grid"
        sortField="createdAt"
        lazy="true"
        [rowsPerPageOptions]="pageSizeChoices"
        [totalRecords]="totalCases"
        (onLazyLoad)="setPaginationAndRefresh($event)"
        class="no-background">

        <ng-template #grid let-cases>
            <div class="grid mt-3">
                <div class="col p-2"*ngFor="let case of cases; let first = first" >
                    <pop-case-search-item 
                    [case]="case"
                    (delete)="deleteCase($event)"/>
                </div>
            </div>
        </ng-template>
    </p-dataView>


<pop-dynamic-modal-form (saveEvent)="refreshCases()"></pop-dynamic-modal-form>

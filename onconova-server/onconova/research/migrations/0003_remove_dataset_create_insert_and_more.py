# Generated by Django 5.1 on 2025-06-24 09:56

import pgtrigger.compiler
import pgtrigger.migrations
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('research', '0002_remove_cohort_create_insert_and_more'),
    ]

    operations = [
        pgtrigger.migrations.RemoveTrigger(
            model_name='dataset',
            name='create_insert',
        ),
        pgtrigger.migrations.RemoveTrigger(
            model_name='dataset',
            name='update_update',
        ),
        pgtrigger.migrations.RemoveTrigger(
            model_name='dataset',
            name='delete_delete',
        ),
        migrations.AddField(
            model_name='dataset',
            name='summary',
            field=models.TextField(blank=True, help_text='Summary of the dataset', null=True, verbose_name='Dataset summary'),
        ),
        migrations.AddField(
            model_name='datasetevent',
            name='summary',
            field=models.TextField(blank=True, help_text='Summary of the dataset', null=True, verbose_name='Dataset summary'),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='dataset',
            trigger=pgtrigger.compiler.Trigger(name='create_insert', sql=pgtrigger.compiler.UpsertTriggerSql(func='INSERT INTO "research_datasetevent" ("external_source", "external_source_id", "id", "name", "pgh_context", "pgh_context_id", "pgh_created_at", "pgh_label", "pgh_obj_id", "project_id", "rules", "summary") VALUES (NEW."external_source", NEW."external_source_id", NEW."id", NEW."name", COALESCE(NULLIF(CURRENT_SETTING(\'pghistory.context_metadata\', TRUE), \'\'), NULL)::JSONB, COALESCE(NULLIF(CURRENT_SETTING(\'pghistory.context_id\', TRUE), \'\'), NULL)::UUID, NOW(), \'create\', NEW."id", NEW."project_id", NEW."rules", NEW."summary"); RETURN NULL;', hash='649f0d4be0125757b31ab529bfc9205070ec3164', operation='INSERT', pgid='pgtrigger_create_insert_95ecc', table='research_dataset', when='AFTER')),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='dataset',
            trigger=pgtrigger.compiler.Trigger(name='update_update', sql=pgtrigger.compiler.UpsertTriggerSql(condition='WHEN (OLD.* IS DISTINCT FROM NEW.*)', func='INSERT INTO "research_datasetevent" ("external_source", "external_source_id", "id", "name", "pgh_context", "pgh_context_id", "pgh_created_at", "pgh_label", "pgh_obj_id", "project_id", "rules", "summary") VALUES (NEW."external_source", NEW."external_source_id", NEW."id", NEW."name", COALESCE(NULLIF(CURRENT_SETTING(\'pghistory.context_metadata\', TRUE), \'\'), NULL)::JSONB, COALESCE(NULLIF(CURRENT_SETTING(\'pghistory.context_id\', TRUE), \'\'), NULL)::UUID, NOW(), \'update\', NEW."id", NEW."project_id", NEW."rules", NEW."summary"); RETURN NULL;', hash='406eb7b29bc6bc7646a88756a95a615a277f7d93', operation='UPDATE', pgid='pgtrigger_update_update_0548b', table='research_dataset', when='AFTER')),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='dataset',
            trigger=pgtrigger.compiler.Trigger(name='delete_delete', sql=pgtrigger.compiler.UpsertTriggerSql(func='INSERT INTO "research_datasetevent" ("external_source", "external_source_id", "id", "name", "pgh_context", "pgh_context_id", "pgh_created_at", "pgh_label", "pgh_obj_id", "project_id", "rules", "summary") VALUES (OLD."external_source", OLD."external_source_id", OLD."id", OLD."name", COALESCE(NULLIF(CURRENT_SETTING(\'pghistory.context_metadata\', TRUE), \'\'), NULL)::JSONB, COALESCE(NULLIF(CURRENT_SETTING(\'pghistory.context_id\', TRUE), \'\'), NULL)::UUID, NOW(), \'delete\', OLD."id", OLD."project_id", OLD."rules", OLD."summary"); RETURN NULL;', hash='b38e35464230223a46f9011b78e79a5f7453b823', operation='DELETE', pgid='pgtrigger_delete_delete_59809', table='research_dataset', when='AFTER')),
        ),
    ]
